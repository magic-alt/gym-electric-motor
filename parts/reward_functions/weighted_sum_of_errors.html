<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Weighted Sum of Errors &mdash; gym-electric-motor 2021 documentation</title><link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Physical Systems" href="../physical_systems/physical_system.html" />
    <link rel="prev" title="Reward Functions" href="reward_function.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> gym-electric-motor
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Gym Electric Motor Readme:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../readme.html">Readme File</a></li>
</ul>
<p class="caption"><span class="caption-text">gym-electric-motor Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../environments/environment.html">Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_generators/reference_generator.html">Reference Generators</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="reward_function.html">Reward Functions</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Weighted Sum of Errors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../physical_systems/physical_system.html">Physical Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualizations/visualization.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../constraint_monitor.html">Constraint Monitor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core.html">Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils.html">Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../callbacks.html">Callbacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../random_component.html">Random Component</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">gym-electric-motor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="reward_function.html">Reward Functions</a> &raquo;</li>
      <li>Weighted Sum of Errors</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/parts/reward_functions/weighted_sum_of_errors.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="weighted-sum-of-errors">
<h1>Weighted Sum of Errors<a class="headerlink" href="#weighted-sum-of-errors" title="Permalink to this headline"></a></h1>
<div class="section" id="usage-guide">
<h2>Usage Guide<a class="headerlink" href="#usage-guide" title="Permalink to this headline"></a></h2>
<p>To use the weighted sum of errors, you have to import the class, initialize an object and pass it to the environment.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gym_electric_motor</span> <span class="k">as</span> <span class="nn">gem</span>
<span class="kn">from</span> <span class="nn">gym_electric_motor.reward_functions</span> <span class="kn">import</span> <span class="n">WeightedSumOfErrors</span>


<span class="c1"># initialize the reward function</span>
<span class="n">wse</span> <span class="o">=</span> <span class="n">WeightedSumOfErrors</span><span class="p">(</span>
    <span class="n">reward_weights</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">i_a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">i_e</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># Current control problem. Tracking of i_e is rewarded better.</span>
    <span class="n">reward_power</span><span class="o">=</span><span class="mi">2</span> <span class="c1"># Squared Error</span>
    <span class="c1"># Alternative: reward_power=dict(i_a=1, i_e=0.5) Absolute error i_a, root error on i_e</span>
    <span class="n">bias</span><span class="o">=</span><span class="s1">&#39;positive&#39;</span> <span class="c1"># Shift the reward range from negative to positive</span>
    <span class="n">violation_reward</span><span class="o">=-</span><span class="mi">250</span> <span class="c1"># Self defined violation reward</span>
    <span class="n">gamma</span><span class="o">=</span><span class="mf">0.9</span> <span class="c1"># Ignored, if a violation_reward is defined.</span>
    <span class="n">normed_reward_weights</span><span class="o">=</span><span class="kc">False</span> <span class="c1"># Otherwise weights will be normed automatically to sum up to 1.</span>

<span class="p">)</span>

<span class="c1"># pass it to the environment</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">gem</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s1">&#39;my-env-id-v0&#39;</span><span class="p">,</span> <span class="n">reward_function</span><span class="o">=</span><span class="n">wse</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="api-documentation">
<h2>API Documentation<a class="headerlink" href="#api-documentation" title="Permalink to this headline"></a></h2>
<dl class="class">
<dt id="gym_electric_motor.reward_functions.weighted_sum_of_errors.WeightedSumOfErrors">
<em class="property">class </em><code class="sig-prename descclassname">gym_electric_motor.reward_functions.weighted_sum_of_errors.</code><code class="sig-name descname">WeightedSumOfErrors</code><span class="sig-paren">(</span><em class="sig-param">reward_weights=None</em>, <em class="sig-param">normed_reward_weights=False</em>, <em class="sig-param">violation_reward=None</em>, <em class="sig-param">gamma=0.9</em>, <em class="sig-param">reward_power=1</em>, <em class="sig-param">bias=0.0</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/gym_electric_motor/reward_functions/weighted_sum_of_errors.html#WeightedSumOfErrors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gym_electric_motor.reward_functions.weighted_sum_of_errors.WeightedSumOfErrors" title="Permalink to this definition"></a></dt>
<dd><p>A reward function that calculates the reward as the weighted sum of errors with a certain power.</p>
<div class="math notranslate nohighlight">
\[r_{wse} = - \sum_i w_i ((|s_i-s^*_i|) / l_i) ^{n_i} + b\]</div>
<dl class="simple">
<dt>Notation:</dt><dd><ul class="simple">
<li><p><span class="math notranslate nohighlight">\(r_\mathrm{wse}\)</span>: Weighted sum of error reward</p></li>
<li><p><span class="math notranslate nohighlight">\(w_{i}\)</span>: Reward weight of state <span class="math notranslate nohighlight">\(i\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(s_{i}\)</span>: State value of state <span class="math notranslate nohighlight">\(i\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(s^*_{i}\)</span>: Reference value of state <span class="math notranslate nohighlight">\(i\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(l_{i}\)</span>: State length of state <span class="math notranslate nohighlight">\(i\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(n_{i}\)</span>: Reward power of state <span class="math notranslate nohighlight">\(i\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(b\)</span>: Bias</p></li>
</ul>
</dd>
</dl>
<div class="line-block">
<div class="line"><span class="math notranslate nohighlight">\(l_i = 1\)</span> for states with positive values only.</div>
<div class="line"><span class="math notranslate nohighlight">\(l_i = 2\)</span> for states with positive and negative values.</div>
</div>
<p>If environments constraints are violated to a certain degree, a special violation reward is returned as follows:</p>
<div class="math notranslate nohighlight">
\[r_{total} = (1.0 - d_{violation})  r_{wse} + d_{violation} r_{violation}\]</div>
<dl class="simple">
<dt>Notation:</dt><dd><ul class="simple">
<li><p><span class="math notranslate nohighlight">\(r_{total}\)</span>: Total reward</p></li>
<li><p><span class="math notranslate nohighlight">\(r_{wse}\)</span>: Weighted sum of error reward</p></li>
<li><p><span class="math notranslate nohighlight">\(r_{violation}\)</span>: Constraint violation reward</p></li>
<li><p><span class="math notranslate nohighlight">\(d_{violation}\)</span>: Limit violation degree <span class="math notranslate nohighlight">\(d_{violation} \in [0,1]\)</span></p></li>
</ul>
</dd>
</dl>
<p>The violation reward can be chosen freely by the user and shall punish the agents to comply with the constraints.
Per default, the violation reward is selected so that it is always the worst expected reward the agent could get.</p>
<div class="math notranslate nohighlight">
\[r_{violation} = r_{wse,min} / (1 - \gamma)\]</div>
<p><span class="math notranslate nohighlight">\(r_{wse,min}\)</span> is the minimal <span class="math notranslate nohighlight">\(r_{wse}\)</span> (=reward_range[0]) and <span class="math notranslate nohighlight">\(\gamma\)</span> the agents discount factor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>reward_weights</strong> (<em>dict/list/ndarray</em><em>(</em><em>float</em><em>)</em>) – Dict mapping state names to reward_weights, 0 otherwise.
Or an array with the reward_weights on the position of the state_names.</p></li>
<li><p><strong>normed_reward_weights</strong> (<em>bool</em>) – If True, the reward weights will be normalized to sum up to 1.</p></li>
<li><p><strong>violation_reward</strong> (<em>None/float</em>) – <p>The punishment reward if constraints have been violated.</p>
<ul>
<li><p>None(default): Per default, the violation reward is calculated as described above.</p></li>
<li><p>float: This value is taken as limit violation reward.</p></li>
</ul>
</p></li>
<li><p><strong>gamma</strong> (<em>float in</em><em> [</em><em>0.0</em><em>, </em><em>1.0</em><em>]</em>) – Discount factor for the reward punishment.
Should equal agents’ discount factor gamma. Used only, if violation_reward=None.</p></li>
<li><p><strong>reward_power</strong> (<em>dict/list</em><em>(</em><em>float</em><em>)</em><em>/float</em>) – Reward power for each of the systems states.</p></li>
<li><p><strong>bias</strong> (<em>float/'positive'</em>) – <p>Additional bias that is added to the reward.</p>
<ul>
<li><p>float: The value that is added</p></li>
<li><p>’positive’: The bias is selected so that the minimal reward is zero and all further are positive.</p></li>
</ul>
</p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="gym_electric_motor.reward_functions.weighted_sum_of_errors.WeightedSumOfErrors.close">
<code class="sig-name descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gym_electric_motor.reward_functions.weighted_sum_of_errors.WeightedSumOfErrors.close" title="Permalink to this definition"></a></dt>
<dd><p>Called, when the environment is closed to store logs, close files etc.</p>
</dd></dl>

<dl class="method">
<dt id="gym_electric_motor.reward_functions.weighted_sum_of_errors.WeightedSumOfErrors.reset">
<code class="sig-name descname">reset</code><span class="sig-paren">(</span><em class="sig-param">initial_state=None</em>, <em class="sig-param">initial_reference=None</em><span class="sig-paren">)</span><a class="headerlink" href="#gym_electric_motor.reward_functions.weighted_sum_of_errors.WeightedSumOfErrors.reset" title="Permalink to this definition"></a></dt>
<dd><p>This function is called by the environment when reset.</p>
<p>Inner states of the reward function can be reset here, if necessary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>initial_state</strong> (<em>ndarray</em><em>(</em><em>float</em><em>)</em>) – Initial state array of the Environment</p></li>
<li><p><strong>initial_reference</strong> (<em>ndarray</em><em>(</em><em>float</em><em>)</em>) – Initial reference array of the environment.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="gym_electric_motor.reward_functions.weighted_sum_of_errors.WeightedSumOfErrors.reward">
<code class="sig-name descname">reward</code><span class="sig-paren">(</span><em class="sig-param">state</em>, <em class="sig-param">reference</em>, <em class="sig-param">k=None</em>, <em class="sig-param">action=None</em>, <em class="sig-param">violation_degree=0.0</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/gym_electric_motor/reward_functions/weighted_sum_of_errors.html#WeightedSumOfErrors.reward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gym_electric_motor.reward_functions.weighted_sum_of_errors.WeightedSumOfErrors.reward" title="Permalink to this definition"></a></dt>
<dd><p>Reward calculation. If limits have been violated the reward is calculated with a separate function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<em>ndarray</em><em>(</em><em>float</em><em>)</em>) – Environments state array.</p></li>
<li><p><strong>reference</strong> (<em>ndarray</em><em>(</em><em>float</em><em>)</em>) – Environments reference array.</p></li>
<li><p><strong>k</strong> (<em>int</em>) – Systems momentary time-step</p></li>
<li><p><strong>action</strong> (<em>element of action space</em>) – The previously taken action.</p></li>
<li><p><strong>violation_degree</strong> (<em>float in</em><em> [</em><em>0.0</em><em>, </em><em>1.0</em><em>]</em>) – Degree of violation of the constraints. 0.0 indicates that all
constraints are complied. 1.0 indicates that the constraints have been so much violated, that a reset is
necessary.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Reward for this state, reference, action tuple.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="gym_electric_motor.reward_functions.weighted_sum_of_errors.WeightedSumOfErrors.set_modules">
<code class="sig-name descname">set_modules</code><span class="sig-paren">(</span><em class="sig-param">physical_system</em>, <em class="sig-param">reference_generator</em>, <em class="sig-param">constraint_monitor</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/gym_electric_motor/reward_functions/weighted_sum_of_errors.html#WeightedSumOfErrors.set_modules"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gym_electric_motor.reward_functions.weighted_sum_of_errors.WeightedSumOfErrors.set_modules" title="Permalink to this definition"></a></dt>
<dd><p>Setting of the physical system, to set state arrays fitting to the environments states</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>physical_system</strong> (<a class="reference internal" href="../physical_systems/physical_system.html#gym_electric_motor.core.PhysicalSystem" title="gym_electric_motor.core.PhysicalSystem"><em>PhysicalSystem</em></a>) – The physical system of the environment</p></li>
<li><p><strong>reference_generator</strong> (<a class="reference internal" href="../reference_generators/reference_generator.html#gym_electric_motor.core.ReferenceGenerator" title="gym_electric_motor.core.ReferenceGenerator"><em>ReferenceGenerator</em></a>) – The reference generator of the environment.</p></li>
<li><p><strong>constraint_monitor</strong> (<a class="reference internal" href="../core.html#gym_electric_motor.core.ConstraintMonitor" title="gym_electric_motor.core.ConstraintMonitor"><em>ConstraintMonitor</em></a>) – The constraint monitor of the environment.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="reward_function.html" class="btn btn-neutral float-left" title="Reward Functions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../physical_systems/physical_system.html" class="btn btn-neutral float-right" title="Physical Systems" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Praneeth Balakrishna, Gerrit Book, Felix Book, Darius Jakobeit, Wilhelm Kirchgässner, Maximilian Schenke, Arne Traue, Oliver Wallscheid.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>